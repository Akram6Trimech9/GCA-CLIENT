<main role="main" class="container-fluid mt-4">
 
  <div class="header">
    <span class="text-white">Gestion des Dépenses</span>
    <div >
     </div>
</div>

  <div class="mt-5">
    <div class="grid mb-4">
      <div class="total-card p-3 rounded shadow">
        <h3 class="text-center">Total</h3>
        <span *ngIf="!isEditing" (click)="isEditing = true" class="total-value">{{ total }}</span>
        <div *ngIf="isEditing" class="d-flex justify-content-center">
          <input type="number" [(ngModel)]="total" (ngModelChange)="updateTotal()" class="form-control me-2" />
          <button (click)="edit()" class="btn btn-primary">OK</button>
        </div>
        <span *ngIf="!isEditing" class="edit-icon" (click)="isEditing = true">✏️</span>
      </div>
      <form [formGroup]="resourceForm" (ngSubmit)="addResource()" class="resource-form">
        <div class="form-group">
          <label for="montant">Montant:</label>
          <input type="number" id="montant" formControlName="montant" class="form-control" required />
          <div *ngIf="resourceForm.get('montant')?.invalid && (resourceForm.get('montant')?.touched || resourceForm.get('montant')?.dirty)">
            <small class="text-danger">Le montant est requis.</small>
          </div>
        </div>
        <div class="form-group">
          <label for="description">Description:</label>
          <input type="text" id="description" formControlName="description" class="form-control" required />
          <div *ngIf="resourceForm.get('description')?.invalid && (resourceForm.get('description')?.touched || resourceForm.get('description')?.dirty)">
            <small class="text-danger">La description est requise.</small>
          </div>
        </div>
        <div class="form-group">
          <label for="date">Date:</label>
          <input type="date" id="date" formControlName="Date" class="form-control" required />
          <div *ngIf="resourceForm.get('Date')?.invalid && (resourceForm.get('Date')?.touched || resourceForm.get('Date')?.dirty)">
            <small class="text-danger">La date est requise.</small>
          </div>
        </div>
        <button type="submit" class="btn btn-success" [disabled]="resourceForm.invalid">Ajouter</button>
      </form>
    </div>

    <div class="resources-list">
      <ul class="list-group">
        <li *ngFor="let resource of resources" class="list-group-item d-flex justify-content-between align-items-center">
          <span class="resource-date">{{ resource.Date | date:'dd/MM/yyyy' }}</span>
          <span class="resource-description flex-grow-1 mx-2">{{ resource.description }}</span>
          <span class="resource-montant">{{ resource.montant | currency:'TND' }}</span>
          <div>
            <button (click)="editResource(resource)" class="btn btn-link text-warning" title="Éditer">
              <i class="bi bi-pencil-fill"></i>
            </button>
            <button (click)="deleteResource(resource)" class="btn btn-link text-danger" title="Supprimer">
              <i class="bi bi-trash-fill"></i>
            </button>
          </div>
        </li>
      </ul>
    </div>
  </div>
</main>

<ng-template #editModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Modifier la Ressource</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="resourceForm" (ngSubmit)="updateResource()">
      <div class="form-group">
        <label for="montant">Montant:</label>
        <input type="number" id="montant" formControlName="montant" class="form-control" required />
      </div>
      <div class="form-group">
        <label for="description">Description:</label>
        <input type="text" id="description" formControlName="description" class="form-control" required />
      </div>
      <div class="form-group">
        <label for="date">Date:</label>
        <input type="date" id="date" formControlName="Date" class="form-control" required />
      </div>
      <button type="submit" class="btn btn-primary" [disabled]="resourceForm.invalid">Enregistrer</button>
    </form>
  </div>
</ng-template>
